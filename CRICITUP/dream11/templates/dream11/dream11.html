{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <title>Cricitup &mdash; L2-T2 Database</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'cricitup/fonts/icomoon/style.css' %}">

  <link rel="stylesheet" href="{% static 'cricitup/css/bootstrap/bootstrap.css' %}"/>
  <link rel="stylesheet" href="{% static 'cricitup/css/jquery-ui.css' %}"/>
  <link rel="stylesheet" href="{% static 'cricitup/css/owl.carousel.min.css' %}"/>
  <link rel="stylesheet" href="{% static 'cricitup/css/owl.theme.default.min.css' %}"/>
  <link rel="stylesheet" href="{% static 'cricitup/css/owl.theme.default.min.css' %}"/>
  
  <link rel="stylesheet" href="{% static 'cricitup/css/jquery.fancybox.min.css' %}"/>
  
  <link rel="stylesheet" href="{% static 'cricitup/css/bootstrap-datepicker.css' %}"/>
  
  <link rel="stylesheet" href="{% static 'cricitup/fonts/flaticon/font/flaticon.css' %}"/>
  
  <link rel="stylesheet" href="{% static 'cricitup/css/aos.css' %}">
  
  <link rel="stylesheet" href="{% static 'cricitup/css/style.css' %}"/>
</head>

<body>

  <div class="site-wrap">

    <div class="site-mobile-menu site-navbar-target">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>

    <header class="site-navbar py-4" role="banner">
      <div class="container">
        <div class="d-flex align-items-center">
          <div class="site-logo">
            <a href="index.html">
              <img src="{% static 'cricitup/images/logo.png' %}" alt="Logo" class="small-logo round-logo"/> 
            </a>
          </div>
          <div class="ml-auto">
            <nav class="site-navigation position-relative text-right" role="navigation">
              <ul class="site-menu main-menu js-clone-nav mr-auto d-none d-lg-block">
                <li ><a href="{% url 'home' %}" class="nav-link">Home</a></li>
                <li ><a href="{% url 'players:players' %}" class="nav-link">Players</a></li>
                <!--- <li><a href="blog.html" class="nav-link">Blog</a></li>-->
                 <!--- <li><a href="contact.html" class="nav-link">Contact</a></li>-->
                <li ><a href="{% url 'grounds:grounds' %}" class="nav-link">Ground</a></li>
                <li ><a href="{% url 'coaches:coaches' %}" class="nav-link">Coaches</a></li>
                <li class="active"><a href="{% url 'umpires:umpires' %}" class="nav-link">Umpires</a></li>
                <li><a href="{% url 'teams:teams' %}" class="nav-link">Teams</a></li>
                <li><a href="{% url 'matches:matches' %}" class="nav-link">Matches</a></li>
                <li><a href="{% url 'dream11:make_your_dream11' %}" class="nav-link">Dream11</a></li>

              </ul>
            </nav>
            <a href="#" class="d-inline-block d-lg-none site-menu-toggle js-menu-toggle text-black float-right text-white">
              <span class="icon-menu h3 text-white"></span>
            </a>
          </div>
        </div>
      </div>
    </header>
    <style>
      
          .small-logo {
        width: 150px; /* Adjust the value to your desired width */
        height: 150; /* Automatically adjust the height based on the aspect ratio */
    }
    
    .site-logo {
        margin-right: 10px; /* Add some space between the logo and the navigation links */
    }
        /* Other styles... */
        
    
        .form-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 70vh; /* Adjust the height as needed */
            margin-top: 100px; /* Adjust the top margin as needed */
        }
    </style>
    <style>
        /* Your existing styles... */
        .content-container {
  margin-top: 140px; /* Adjust the value as needed to move the table down */
}
        .card-container {
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between; /* Distribute cards horizontally */
          margin-top: 20px;
        }
    
  
        .card {
          border: 1px solid #ccc;
          padding: 15px;
          border-radius: 5px;
          box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
          width: calc(30% - 20px); /* Adjust the width as needed */
          background-color: white;
          transition: transform 0.3s ease-in-out;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          margin-bottom: 20px;
        }
  
        .card-image {
          display: flex;
          justify-content: center;
          align-items: center;
          height: 150px; /* Adjust the height as needed */
        }
  
        .card-image img {
          max-width: 100%;
          max-height: 100%;
        }
  
        .card:hover {
          transform: translateY(-5px);
        }
        .player-image-cell
        {
          display: block;
          justify-content: center;
          align-items: center;
          height:150px;
        }
        .player-image-cell img
        {
          max-width: 100%;
          max-height: 100%;
        }
        .player-selection {
            max-height: 300px;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
        }

        /* Style for individual player items */
        .player-item {
            margin: 5px 0;
            padding: 5px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            cursor: pointer;
        }

        /* Style for selected players */
        .selected-player {
            background-color: #3498db;
            color: #fff;
        }
      </style>
    <!-- <section>
      <h1>Grounds</h1>

    </section> -->

      <section class="ftco-section">
        <div class="container">
          <div class="row justify-content-center">
            <!-- <div class="col-md-6 text-center mb-5"> -->
              <div class ="content-container">

              <h2 class="heading-section">Welcome To Dream11</h2>
              <h1>Select Your Dream11 Team</h1>
    <p>Click on players to select them:</p>
    <input type="text" id="playerSearch" placeholder="Search by name">

    <div class="player-selection">
        <!-- Player items will be dynamically added here -->



        <script>
          document.addEventListener("DOMContentLoaded", function() {
            const selectedPlayers = [];

// Get the list of players from Django context
const players = [
    {% for player in players %}
        "{{ player.0 }}",
    {% endfor %}
];
const playerSelectionContainer = document.querySelector(".player-selection");
const selectedPlayersTable = document.getElementById("selectedPlayersTable").getElementsByTagName('tbody')[0];

// Function to create player items and add click event
function createPlayerItem(player) {
    const playerItem = document.createElement("div");
    playerItem.textContent = player;
    playerItem.className = "player-item";
    // Add a click event listener to toggle selection
    playerItem.addEventListener("click", () => {
        playerItem.classList.toggle("selected-player");
        const playerName = playerItem.textContent;
        const playerId = getPlayerIdByName(playerName);

        if (selectedPlayers.includes(playerName)) {
            selectedPlayers.splice(selectedPlayers.indexOf(playerName), 1);
            removeFromDream11(playerId);
        } else {
            selectedPlayers.push(playerName);
            addToDream11(playerId);
        }

        // Update the selected players table
        updateSelectedPlayersTable();
    });

    playerSelectionContainer.appendChild(playerItem);
}

// Function to add a player to the dream11 table
function addToDream11(playerId) {
      alert(playerId)
    fetch('/add_player_to_dream11/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'), // Make sure to include the CSRF token
        },
        body: JSON.stringify({ playerId }),
    })
    .then(response => {
        if (response.ok) {
            // Player added successfully
        } else {
           alert('Failed to add player to dream11');
        }
    })
    .catch(error => {
      alert("error: "+error)
        console.error('Error:', error);
    });
}

// Function to remove a player from the dream11 table
function removeFromDream11(playerId) {
    fetch('/remove_player_from_dream11/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'), // Make sure to include the CSRF token
        },
        body: JSON.stringify({ playerId }),
    })
    .then(response => {
        if (response.ok) {
            // Player removed successfully
        } else {
            console.error('Failed to remove player from dream11');
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

// Function to get the player ID by name
function getPlayerIdByName(playerName) {
    // Implement logic to find the player ID based on the player's name.
    // You can loop through your player data to find the player ID.
    // Replace this with your actual implementation.
    fetch('/get_player_id_by_name/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'), // Include CSRF token
            },
            body: JSON.stringify({ playerName }),
            
        })
        .then(response => response.json())
        .then(data => {
            // Handle the response data, which should contain the player ID
            const playerId = data;
            alert('playerid: '+playerId)
            return playerId;
        })
        .catch(error => {
          alert(error)
            console.error('Error:', error);
        });
}

// Function to update the selected players table
function updateSelectedPlayersTable() {
    // Clear the existing table rows
    selectedPlayersTable.innerHTML = '';

    // Add the selected players to the table
    selectedPlayers.forEach((player) => {
        const row = selectedPlayersTable.insertRow();
        const cell = row.insertCell(0);
        cell.textContent = player;
    });
}

// Function to get the CSRF token from cookies
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) 
    {
      const csrfToken = parts.pop().split(';').shift();
        return csrfToken;
    }
    
}

// Populate the player selection box
players.forEach((player) => {
    createPlayerItem(player);
});

// Get the search input element
const playerSearchInput = document.getElementById("playerSearch");

// Function to filter players based on search input
function filterPlayers() {
    const searchText = playerSearchInput.value.toLowerCase();
    const playerItems = document.querySelectorAll(".player-item");

    playerItems.forEach((playerItem) => {
        const playerName = playerItem.textContent;
        if (playerName.includes(searchText)) {
            playerItem.style.display = "block";
        } else {
            playerItem.style.display = "none";
        }
    });
}

// Add a keyup event listener to the search input
playerSearchInput.addEventListener("keyup", filterPlayers);
    // Your JavaScript code here
});
          // Define an array to store selected players
          
      </script>

          </div>
      </div>
      </section>
      
      </section>
      
    <div>
      <h1>Selected Players</h1>
      <table id="selectedPlayersTable">
        <thead>
            <tr>
                <th>Selected Players</th>
            </tr>
        </thead>
        <tbody>
            <!-- Selected players will be added here -->
        </tbody>
    </table>
      
              </div>
  
      <!-- ... (Your script section remains unchanged) ... -->
  
    </div>
  
    </section>
    

    <!-- .site-wrap -->
    <script src="{% static 'cricitup/js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery-migrate-3.0.1.min.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery-ui.js' %}"></script>
    <script src="{% static 'cricitup/js/popper.min.js' %}"></script>
    <script src="{% static 'cricitup/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'cricitup/js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery.stellar.min.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery.countdown.min.js' %}"></script>
    <script src="{% static 'cricitup/js/bootstrap-datepicker.min.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery.easing.1.3.js' %}"></script>
    <script src="{% static 'cricitup/js/aos.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery.fancybox.min.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery.sticky.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery.mb.YTPlayer.min.js' %}"></script>
    <script src="{% static 'cricitup/js/jquery-3.3.1.min.js' %}"></script>
    <!-- ... (Rest of the scripts) ... -->

</body>

</html>
