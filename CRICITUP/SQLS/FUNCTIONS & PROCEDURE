CREATE OR REPLACE PROCEDURE Rating_Update IS 

run1 NUMBER:=0;
run2 NUMBER :=0;
winner NUMBER;
looser NUMBER;

BEGIN
FOR M IN (SELECT MATCH_ID,TEAM1_ID,TEAM2_ID FROM MATCH)
LOOP
	
	SELECT SUM(TOTAL_RUNS) INTO run1 FROM SCORECARD WHERE MATCH_ID=M.MATCH_ID
	AND PLAYER_ID IN (SELECT PLAYERID FROM PLAYER WHERE TEAM_ID=M.TEAM1_ID);
	
	SELECT SUM(TOTAL_RUNS) INTO run2 FROM SCORECARD WHERE MATCH_ID=M.MATCH_ID
	AND PLAYER_ID IN (SELECT PLAYERID FROM PLAYER WHERE TEAM_ID=M.TEAM2_ID);
	
	IF run1 >run2 THEN 
	winner:=M.TEAM1_ID;
	looser:=M.TEAM2_ID;
	ELSE 
	winner :=M.TEAM2_ID;
	looser :=M.TEAM1_ID;
	END IF;
	
	UPDATE MATCH 
	SET WINNER=winner
	WHERE MATCH_ID=M.MATCH_ID;
-- 	
	UPDATE TEAM 
	SET TEAM_RATING=TEAM_RATING+2
	WHERE TEAM_ID=winner;
	
	UPDATE TEAM 
	SET TEAM_RATING=TEAM_RATING-1
	WHERE TEAM_ID=looser;
	
END LOOP;

END;
/


CREATE OR REPLACE PROCEDURE RESET_RATING IS 

BEGIN

UPDATE TEAM 
SET TEAM_RATING=0;
END;
/